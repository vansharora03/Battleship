(()=>{"use strict";const t=function(t=null){return{length:t,hits:0,hit:function(){this.isSunk()||this.hits++},isSunk:function(){return this.hits>=this.length}}},e=function(){const t={board:function(t){let e=[];for(let t=0;t<7;t++){e[t]=[];for(let a=0;a<7;a++)e[t][a]={ship:null,tried:!1}}return e}(),ships:[],placeShip:function(t,e,a,n=!1){let r=[t,e];if(n){t+a.length-1>=7&&(r=[7-a.length,e]);let n=r[1],o=r[0];for(let t=0;t<a.length;t++)if(this.board[n][o+t].ship)return!1;this.ships.push(a);for(let t=0;t<a.length;t++)this.board[n][o+t].ship=a}else{e+a.length-1>=7&&(r=[t,7-a.length]);let n=r[1],o=r[0];for(let t=0;t<a.length;t++)if(this.board[n+t][o].ship)return!1;this.ships.push(a);for(let t=0;t<a.length;t++)this.board[n+t][o].ship=a}return!0},receiveAttack:function(t,e){let a=this.board[e][t];return!a.tried&&(a.tried=!0,null!==a.ship&&a.ship.hit(),!0)},lost:function(){return this.ships.every((t=>t.isSunk()))}},e=new Set,a=function(t,e){return this.opponent.gameboard.receiveAttack(t,e)},n=function(t){return Math.floor(Math.random()*t)},r=function(t=n){let o=t(7),s=t(7);if(!e.has(this.opponent.gameboard.board[s][o]))return a.call(this,o,s),e.add(this.opponent.gameboard.board[s][o]),[o,s];r.call(this,t)};return{gameboard:t,opponent:null,attack:a,computerAttack:r}},a=document.querySelector(".content"),n=document.querySelector(".start-game-btn"),r=function(a){const n=e(),r=e();n.opponent=r,r.opponent=n;let o=n;const s=document.querySelector(".game-status"),d=[t(2),t(1),t(3)];let l=0;const i=function(){const e=new t(2),a=new t(3),n=new t(5);r.gameboard.placeShip(0,0,e),r.gameboard.placeShip(3,1,a),r.gameboard.placeShip(2,5,n,!0),c(r)},c=function(t){const e=t==n?".user-board-square":".computer-board-square";document.querySelectorAll(e).forEach((e=>{const a=t.gameboard.board[parseInt(e.dataset.y)][parseInt(e.dataset.x)];null!==a.ship?(e.classList.add("ship"),a.tried&&(e.classList.remove("ship"),e.classList.add("damaged-ship"))):a.tried&&e.classList.add("missed")}))},u=function(t){let e=d[l].length;const a=document.querySelectorAll(".user-board-square");let r=parseInt(t.target.dataset.x),o=parseInt(t.target.dataset.y),s=[r,o];o+e-1>=7&&(s=[r,7-e]);let i=s[1],c=s[0];for(let a=0;a<e;a++)if(n.gameboard.board[i+a][c].ship)return t.target.classList.add("not-placeable"),void t.target.addEventListener("mouseout",(()=>{t.target.classList.remove("not-placeable")}));let u=new Set;for(let n=0;n<e;n++)a.forEach((e=>{e.dataset.y===i+n+""&&e.dataset.x===c+""&&(e.classList.add("placeable"),u.add(e)),t.target.addEventListener("mouseout",(()=>{u.forEach((t=>{u.delete(t),t.classList.remove("placeable")}))}))}))},p=function(t){if(t.target.classList.contains("not-placeable"))return;let e=d[l];n.gameboard.placeShip(parseInt(t.target.dataset.x),parseInt(t.target.dataset.y),e),c(n),l++,l>=d.length?(document.querySelectorAll(".user-board-square").forEach((t=>{t.removeEventListener("mouseover",u),t.removeEventListener("click",p)})),h()):s.textContent=`Place your ${d[l].length}-length ship`},h=function(){s.textContent="Strike the enemy!",g(n)},m=function(t){const e=document.createElement("div");e.classList.add("game-over"),e.textContent=t===r?"You Lost!":"You Won!",document.querySelector(".content").appendChild(e)},g=function(t,e=!0){let a=t.opponent;const s=a==n?".user-board-square":".computer-board-square",d=document.querySelectorAll(s),l=document.querySelector(".game-status");d.forEach((s=>{s.addEventListener("click",(d=>{if(o!==t)return;let i=t.attack(parseInt(s.dataset.x),parseInt(s.dataset.y));i&&null!==a.gameboard.board[parseInt(s.dataset.y)][parseInt(s.dataset.x)].ship?(l.textContent="Ship damaged!",a.gameboard.lost()&&(l.textContent="You win!",m(n))):l.textContent=i?"Miss!":"Already struck here! Try again.",c(a),!0===i&&(o=a,!0===e&&o===r&&(r.computerAttack(),c(r.opponent),r.opponent.gameboard.lost()&&(document.querySelector(".game-status").textContent="Computer wins!",m(r)),o=r.opponent))}))}))};return{setUpUserBoard:function(){const t=document.createElement("div");t.classList.add("user-board");for(let e=0;e<n.gameboard.board.length;e++)for(let a=0;a<n.gameboard.board[e].length;a++){const n=document.createElement("div");n.classList.add("user-board-square"),n.dataset.x=a,n.dataset.y=e,t.appendChild(n)}a.appendChild(t)},setUpComputerBoard:function(){const t=document.createElement("div");t.classList.add("computer-board");for(let e=0;e<r.gameboard.board.length;e++)for(let a=0;a<r.gameboard.board[e].length;a++){const n=document.createElement("div");n.classList.add("computer-board-square"),n.dataset.x=a,n.dataset.y=e,t.appendChild(n)}a.appendChild(t)},startGameAuto:function(){!function(){const e=new t(2),a=new t(3),r=new t(5);n.gameboard.placeShip(0,0,e),n.gameboard.placeShip(3,1,a),n.gameboard.placeShip(2,5,r,!0),c(n)}(),i(),g(n)},startGame:function(){document.querySelector(".start-game-btn").style.visibility="hidden",document.querySelector(".game-status").textContent=`Place your ${d[l].length}-length ship`,i(),document.querySelectorAll(".user-board-square").forEach((t=>{t.addEventListener("mouseover",u),t.addEventListener("click",p)}))}}}(a);r.setUpUserBoard(),r.setUpComputerBoard(),n.addEventListener("click",(()=>{r.startGame()}))})();