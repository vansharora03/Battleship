(()=>{"use strict";const e=function(e=null){return{length:e,hits:0,hit:function(){this.isSunk()||this.hits++},isSunk:function(){return this.hits>=this.length}}},t=function(){const e={board:function(e){let t=[];for(let e=0;e<7;e++){t[e]=[];for(let a=0;a<7;a++)t[e][a]={ship:null,tried:!1}}return t}(),ships:[],placeShip:function(e,t,a,n=!1){let r=[e,t];if(n){e+a.length-1>=7&&(r=[7-a.length,t]);let n=r[1],o=r[0];for(let e=0;e<a.length;e++)if(this.board[n][o+e].ship)return!1;this.ships.push(a);for(let e=0;e<a.length;e++)this.board[n][o+e].ship=a}else{t+a.length-1>=7&&(r=[e,7-a.length]);let n=r[1],o=r[0];for(let e=0;e<a.length;e++)if(this.board[n+e][o].ship)return!1;this.ships.push(a);for(let e=0;e<a.length;e++)this.board[n+e][o].ship=a}return!0},receiveAttack:function(e,t){let a=this.board[t][e];return!a.tried&&(a.tried=!0,null!==a.ship&&a.ship.hit(),!0)},lost:function(){return this.ships.every((e=>e.isSunk()))}},t=new Set,a=function(e,t){return this.opponent.gameboard.receiveAttack(e,t)},n=function(e){return Math.floor(Math.random()*e)},r=function(e=n){let o=e(7),s=e(7);if(!t.has(this.opponent.gameboard.board[s][o]))return a.call(this,o,s),t.add(this.opponent.gameboard.board[s][o]),[o,s];r.call(this,e)};return{gameboard:e,opponent:null,attack:a,computerAttack:r}},a=document.querySelector(".content"),n=document.querySelector(".start-game-btn"),r=function(a){const n=t(),r=t();n.opponent=r,r.opponent=n;let o=n;const s=document.querySelector(".game-status"),d=[e(2),e(1),e(3)];let l=0,i=!1;const c=function(){const t=new e(2),a=new e(3),n=new e(5);r.gameboard.placeShip(0,0,t),r.gameboard.placeShip(3,1,a),r.gameboard.placeShip(2,5,n,!0),u(r)},u=function(e){const t=e==n?".user-board-square":".computer-board-square";document.querySelectorAll(t).forEach((t=>{const a=e.gameboard.board[parseInt(t.dataset.y)][parseInt(t.dataset.x)];null!==a.ship?(t.classList.add("ship"),a.tried&&(t.classList.remove("ship"),t.classList.add("damaged-ship"))):a.tried&&t.classList.add("missed")}))},p=function(e){let t=d[l].length;const a=document.querySelectorAll(".user-board-square");let r=parseInt(e.target.dataset.x),o=parseInt(e.target.dataset.y),s=[r,o];if(i){r+t-1>=7&&(s=[7-t,o]);let d=s[1],l=s[0];for(let a=0;a<t;a++)if(n.gameboard.board[d][l+a].ship)return e.target.classList.add("not-placeable"),void e.target.addEventListener("mouseout",(()=>{e.target.classList.remove("not-placeable")}));let i=new Set;for(let n=0;n<t;n++)a.forEach((t=>{t.dataset.y===d+""&&t.dataset.x===l+n+""&&(t.classList.add("placeable"),i.add(t)),e.target.addEventListener("mouseout",(()=>{i.forEach((e=>{i.delete(e),e.classList.remove("placeable")}))}))}));return}o+t-1>=7&&(s=[r,7-t]);let c=s[1],u=s[0];for(let a=0;a<t;a++)if(n.gameboard.board[c+a][u].ship)return e.target.classList.add("not-placeable"),void e.target.addEventListener("mouseout",(()=>{e.target.classList.remove("not-placeable")}));let p=new Set;for(let n=0;n<t;n++)a.forEach((t=>{t.dataset.y===c+n+""&&t.dataset.x===u+""&&(t.classList.add("placeable"),p.add(t)),e.target.addEventListener("mouseout",(()=>{p.forEach((e=>{p.delete(e),e.classList.remove("placeable")}))}))}))},h=function(e){if(e.target.classList.contains("not-placeable"))return;let t=d[l];n.gameboard.placeShip(parseInt(e.target.dataset.x),parseInt(e.target.dataset.y),t,i),u(n),l++,l>=d.length?(document.querySelectorAll(".user-board-square").forEach((e=>{e.removeEventListener("mouseover",p),e.removeEventListener("click",h)})),document.querySelector(".rotate-btn").style.visibility="hidden",m()):s.textContent=`Place your ${d[l].length}-length ship`},m=function(){s.textContent="Strike the enemy!",g(n)},b=function(e){const t=document.createElement("div");t.classList.add("game-over"),t.textContent=e===r?"You Lost!":"You Won!",document.querySelector(".content").appendChild(t)},g=function(e,t=!0){let a=e.opponent;const s=a==n?".user-board-square":".computer-board-square",d=document.querySelectorAll(s),l=document.querySelector(".game-status");d.forEach((s=>{s.addEventListener("click",(d=>{if(o!==e)return;let i=e.attack(parseInt(s.dataset.x),parseInt(s.dataset.y));i&&null!==a.gameboard.board[parseInt(s.dataset.y)][parseInt(s.dataset.x)].ship?(l.textContent="Ship damaged!",a.gameboard.lost()&&(l.textContent="You win!",b(n))):l.textContent=i?"Miss!":"Already struck here! Try again.",u(a),!0===i&&(o=a,!0===t&&o===r&&(r.computerAttack(),u(r.opponent),r.opponent.gameboard.lost()&&(document.querySelector(".game-status").textContent="Computer wins!",b(r)),o=r.opponent))}))}))};return{setUpUserBoard:function(){const e=document.createElement("div");e.classList.add("user-board");for(let t=0;t<n.gameboard.board.length;t++)for(let a=0;a<n.gameboard.board[t].length;a++){const n=document.createElement("div");n.classList.add("user-board-square"),n.dataset.x=a,n.dataset.y=t,e.appendChild(n)}a.appendChild(e)},setUpComputerBoard:function(){const e=document.createElement("div");e.classList.add("computer-board");for(let t=0;t<r.gameboard.board.length;t++)for(let a=0;a<r.gameboard.board[t].length;a++){const n=document.createElement("div");n.classList.add("computer-board-square"),n.dataset.x=a,n.dataset.y=t,e.appendChild(n)}a.appendChild(e)},startGameAuto:function(){!function(){const t=new e(2),a=new e(3),r=new e(5);n.gameboard.placeShip(0,0,t),n.gameboard.placeShip(3,1,a),n.gameboard.placeShip(2,5,r,!0),u(n)}(),c(),g(n)},startGame:function(){document.querySelector(".start-game-btn").style.visibility="hidden";const e=document.querySelector(".rotate-btn");e.style.visibility="visible",e.addEventListener("click",(()=>{i=!i})),document.querySelector(".game-status").textContent=`Place your ${d[l].length}-length ship`,c(),document.querySelectorAll(".user-board-square").forEach((e=>{e.addEventListener("mouseover",p),e.addEventListener("click",h)}))}}}(a);r.setUpUserBoard(),r.setUpComputerBoard(),n.addEventListener("click",(()=>{r.startGame()}))})();